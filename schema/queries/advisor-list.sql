select dub1.host_id as [Host ID] , dub1.email as [Student Email] , dub1.preferred_or_first_name as [Student First Name] , dub1.lastname as [Student Last Name] , dub1.grad_year as [Grad Year] , dub2.email as [Advisor Email] , dub2.preferred_or_first_name as [Advisor First Name] , dub2.lastname as [Advisor Last Name] from
dbo.da_user_base(@p1)dub1 INNER JOIN dbo.da_user_detail(@p1)dud1 ON dud1.user_id = dub1.user_id INNER JOIN dbo.da_user_role(@p1)dur1 ON dur1.user_id = dub1.user_id And dur1.role IN (select [value] from dbo.fn_convertlisttosetstr('Student',',')) LEFT OUTER JOIN dbo.da_advisory_enrollment(@p1)adve1 INNER JOIN dbo.da_advisory_group(@p1)advg1 ON advg1.group_id = adve1.group_id INNER JOIN dbo.da_advisory_base(@p1)advb1 ON advb1.advisory_id = advg1.advisory_id And advb1.advisory_code = 'SA' INNER JOIN dbo.da_advisory_faculty(@p1)advf1 ON advf1.group_id = advg1.group_id INNER JOIN dbo.da_user_base(@p1)dub2 ON dub2.user_id = advf1.faculty_user_id LEFT OUTER JOIN dbo.da_advisory_term(@p1)advt1 ON advt1.term_id = advg1.term_id LEFT OUTER JOIN dbo.da_school_year(@p1)sy1 ON sy1.school_year = advt1.school_year ON adve1.student_user_id = dub1.user_id And adve1.dropped = '0'
where sy1.current_year = 1
group by dub1.host_id , dub1.email , dub1.preferred_or_first_name , dub1.lastname , dub1.grad_year , dub2.email , dub2.preferred_or_first_name , dub2.lastname
order by dub2.lastname ASC , dub2.preferred_or_first_name ASC , dub1.grad_year ASC , dub1.lastname ASC , dub1.preferred_or_first_name ASC
