<?!= include('lib', data) ?>
<script>
  const thread = '<?!= data.thread ?>';

  // eslint-disable-next-line no-redeclare
  function showStudentPicker(students) {
    replaceContent(`<form id="student-picker">
          <p>Please select the student for whom to update their course list.</p>
          <div>
            <select id="student" name="student">
              ${students.map(
                ([hostId, , , , firstName, lastName, gradYear]) =>
                  `<option value="${hostId}">${firstName} ${lastName} â€˜${gradYear.substr(
                    2,
                    2
                  )}</option>`
              )}
            </select>
            <button class="create" type="submit">Update Course Plan</button>
          </div>
        </form>`);
    attachEvent(
      document.getElementById('student-picker'),
      'submit',
      handleSubmit
    );
  }

  function handleSubmit(e) {
    if (e.preventDefault) {
      e.preventDefault();
    }
    showProgress();
    google.script.run.updateCourseListSingleFor(
      document.getElementById('student').value,
      thread
    );
    return false;
  }

  google.script.run.withSuccessHandler(showStudentPicker).coursePlanGetAll();
</script>
