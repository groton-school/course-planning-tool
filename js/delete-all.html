<?!= include('lib', data) ?>
<script>
  const thread = '<?!= data.thread ?>';

  function updateProgress() {
    google.script.run
      .withSuccessHandler((progress) => {
        if (progress.complete) {
          google.script.host.close();
        } else {
          replaceContent(progress.html);
          updateProgress();
        }
      })
      .getProgress(thread);
  }

  function deleteAll(e) {
    if (e.preventDefault) {
      e.preventDefault();
    }
    replaceContent('Loadingâ€¦');
    updateProgress();
    google.script.run.deleteAllConfirmed(thread);
    return false;
  }

  attachEvent(document.getElementById('confirmation'), 'submit', deleteAll);
  attachEvent(document.getElementById('cancel'), 'click', () => {
    google.script.host.close();
  });
</script>
