<script>
  const thread = '<?= data.thread ?>';

  function replaceContent(html) {
    document.getElementById('content').innerHTML = html;
  }

  function attachEvent(element, event, handler) {
    if (element.attachEvent) {
      element.attachEvent(event, handler);
    } else {
      element.addEventListener(event, handler);
    }
  }

  function updateProgress() {
    google.script.run
      .withSuccessHandler((progress) => {
        if (progress.complete) {
          google.script.host.close();
        } else {
          replaceContent(progress.html);
          updateProgress();
        }
      })
      .getProgress(thread);
  }

  function deleteAll(e) {
    if (e.preventDefault) {
      e.preventDefault();
    }
    replaceContent('Loadingâ€¦');
    updateProgress();
    google.script.run.deleteAllConfirmed(thread);
    return false;
  }

  attachEvent(document.getElementById('confirmation'), 'submit', deleteAll);
  attachEvent(document.getElementById('cancel'), 'click', () => {
    google.script.host.close();
  });
</script>
